<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Nono Booking Platform</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
.modal-backdrop{background:rgba(0,0,0,0.45);}
</style>
</head>
<body class="bg-gray-50 text-gray-800">

<div id="app" class="min-h-screen flex items-center justify-center p-6" style="background-image: linear-gradient(180deg, rgba(255,255,255,0.6), rgba(255,255,255,0.6)), url('https://images.unsplash.com/photo-1504384308090-c894fdcc538d?auto=format&fit=crop&w=1600&q=80'); background-size:cover;">
  <div id="homeCard" class="bg-white/90 backdrop-blur-md rounded-2xl shadow-2xl p-8 text-center max-w-xl w-full">
    <h1 class="text-3xl font-bold text-gray-900 mb-6">Grow Your Business with Online Bookings</h1>
    <div class="flex flex-col gap-4">
      <button onclick="goTrial()" class="bg-green-500 hover:bg-green-600 text-white font-semibold py-3 rounded-xl shadow-lg transition">7-Day Trial</button>
      <button onclick="renderSignup()" class="bg-blue-500 hover:bg-blue-600 text-white font-semibold py-3 rounded-xl shadow-lg transition">Subscribe ($11/month)</button>
      <button onclick="renderLogin()" class="bg-purple-500 hover:bg-purple-600 text-white font-semibold py-3 rounded-xl shadow-lg transition">Login</button>
    </div>
  </div>
</div>

<script>
/* ---------- Helpers ---------- */
function slugify(s){return String(s||'').toLowerCase().replace(/[^a-z0-9]+/g,'-').replace(/(^-|-$)/g,'');}
function uid(p='id'){return p+'_'+Math.random().toString(36).slice(2,10);}
function getUser(){return JSON.parse(localStorage.getItem('nono_user')||'null');}
function setUser(u){localStorage.setItem('nono_user',JSON.stringify(u));}
function getServices(slug){return JSON.parse(localStorage.getItem('nono_services_'+slug)||'[]');}
function setServices(slug,arr){localStorage.setItem('nono_services_'+slug,JSON.stringify(arr));}
function getBookings(slug){return JSON.parse(localStorage.getItem('nono_bookings_'+slug)||'[]');}
function setBookings(slug,arr){localStorage.setItem('nono_bookings_'+slug,JSON.stringify(arr));}
function downloadFile(name,content){const blob=new Blob([content],{type:'text/csv;charset=utf-8;'});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download=name;document.body.appendChild(a);a.click();a.remove();URL.revokeObjectURL(url);}

/* ---------- Home Actions ---------- */
function goTrial(){
  const email=prompt('Enter Email for Trial');
  const pass=prompt('Enter Password');
  const business=prompt('Business Name');
  if(!email||!pass||!business)return;
  const slug=slugify(business);
  const expires=new Date();expires.setDate(expires.getDate()+7);
  const user={email,pass,business,slug,trial:true,expires:expires.toISOString()};
  setUser(user);
  setServices(slug,[]);
  setBookings(slug,[]);
  renderDashboard(user);
}

function renderSignup(){
  const email=prompt('Enter Email');if(!email)return;
  const pass=prompt('Password');if(!pass)return;
  const business=prompt('Business Name');if(!business)return;
  const slug=slugify(business);
  const now=new Date();now.setMonth(now.getMonth()+1);
  const user={email,pass,business,slug,trial:false,expires:now.toISOString()};
  setUser(user);setServices(slug,[]);setBookings(slug,[]);
  renderDashboard(user);
}

function renderLogin(){
  const email=prompt('Email');const pass=prompt('Password');
  const user=getUser();
  if(!user)return alert('No account');if(user.email!==email||user.pass!==pass)return alert('Invalid');
  const exp=new Date(user.expires);if(new Date()>exp)return alert('Access expired. Please subscribe');
  renderDashboard(user);
}

/* ---------- Dashboard ---------- */
function renderDashboard(user){
  const slug=user.slug;
  const now=new Date();
  const expires=new Date(user.expires);
  const diff=Math.max(0,Math.ceil((expires-now)/(1000*60*60*24)));
  document.body.innerHTML=`
  <div class="min-h-screen p-6 bg-gray-100">
    <header class="flex justify-between items-center mb-6">
      <div>
        <h2 class="text-xl font-bold">${user.business}</h2>
        <div class="text-sm text-gray-500">Email: ${user.email}</div>
        <div class="text-sm text-gray-500">Days left: ${diff}</div>
        <div class="text-sm text-gray-500 mt-1">Share Link: ${location.pathname}?business=${slug}</div>
      </div>
      <button onclick="logout()" class="bg-red-600 text-white px-4 py-2 rounded">Logout</button>
    </header>
    <main class="grid grid-cols-2 gap-6">
      <div>
        <h3 class="font-semibold mb-2">Services</h3>
        <div id="svcContainer" class="space-y-2 mb-4"></div>
        <input id="newSvcName" placeholder="Service Name" class="border rounded p-2 w-full mb-2"/>
        <input id="newSvcPrice" placeholder="Price" type="number" class="border rounded p-2 w-full mb-2"/>
        <button onclick="addService()" class="bg-green-600 text-white px-4 py-2 rounded">Add Service</button>
      </div>
      <div>
        <h3 class="font-semibold mb-2">Bookings</h3>
        <div class="overflow-x-auto bg-white p-2 rounded shadow">
          <table class="min-w-full text-left border">
            <thead><tr><th>Name</th><th>Email</th><th>Phone</th><th>Service</th><th>Date</th></tr></thead>
            <tbody id="bookingBody"></tbody>
          </table>
        </div>
        <button onclick="exportBookings()" class="mt-2 bg-blue-600 text-white px-4 py-2 rounded">Export CSV</button>
      </div>
    </main>
  </div>`;
  populateServices();populateBookings();
}

/* ---------- Service Functions ---------- */
function populateServices(){
  const user=getUser();if(!user)return;
  const svc=getServices(user.slug);const cont=document.getElementById('svcContainer');
  cont.innerHTML=svc.map(s=>`<div class="flex justify-between bg-gray-50 p-2 rounded">
    <div>${s.name} ($${s.price})</div>
    <div>
      <button onclick="editService('${s.id}')" class="bg-yellow-300 px-2 rounded">Edit</button>
      <button onclick="delService('${s.id}')" class="bg-red-500 text-white px-2 rounded">Del</button>
    </div>
  </div>`).join('');
}

function addService(){
  const user=getUser();if(!user)return;
  const name=document.getElementById('newSvcName').value.trim();
  const price=Number(document.getElementById('newSvcPrice').value);
  if(!name)return alert('Name required');const arr=getServices(user.slug);
  arr.push({id:uid(),name,price});setServices(user.slug,arr);populateServices();
  document.getElementById('newSvcName').value='';document.getElementById('newSvcPrice').value='';
}
function editService(id){
  const user=getUser();if(!user)return;
  const arr=getServices(user.slug);const s=arr.find(x=>x.id===id);if(!s)return;
  const name=prompt('Service Name',s.name);if(!name)return;
  const price=Number(prompt('Price',$`${s.price}`));s.name=name;s.price=price;setServices(user.slug,arr);populateServices();
}
function delService(id){const user=getUser();if(!user)return;
  let arr=getServices(user.slug);arr=arr.filter(x=>x.id!==id);setServices(user.slug,arr);populateServices();
}

/* ---------- Booking Table ---------- */
function populateBookings(){const user=getUser();if(!user)return;
const arr=getBookings(user.slug);const body=document.getElementById('bookingBody');
body.innerHTML=arr.map(b=>`<tr><td>${b.name}</td><td>${b.email}</td><td>${b.phone}</td><td>${b.service}</td><td>${b.date}</td></tr>`).join('');}
function exportBookings(){const user=getUser();if(!user)return;
const arr=getBookings(user.slug);if(!arr.length)return alert('No bookings');
const csv=[['Name','Email','Phone','Service','Date'],...arr.map(b=>[b.name,b.email,b.phone,b.service,b.date])].map(r=>r.join(',')).join('\n');
downloadFile(user.slug+'-bookings.csv',csv);
}

/* ---------- Logout ---------- */
function logout(){localStorage.removeItem('nono_user');location.reload();}

/* ---------- Public Booking ---------- */
function renderPublicBooking(slug){
  const svc=getServices(slug);if(!svc.length)return alert('No services');
  document.body.innerHTML=`
  <div class="min-h-screen flex items-center justify-center p-6 bg-gray-100">
    <div class="bg-white p-6 rounded-xl shadow max-w-lg w-full">
      <h2 class="text-xl font-bold mb-4">${slug.replace(/-/g,' ')}</h2>
      <input id="bk_name" placeholder="Name" class="border rounded p-2 w-full mb-2"/>
      <input id="bk_email" placeholder="Email" class="border rounded p-2 w-full mb-2"/>
      <input id="bk_phone" placeholder="Phone" class="border rounded p-2 w-full mb-2"/>
      <select id="bk_service" class="border rounded p-2 w-full mb-2">${svc.map(s=>`<option value="${s.name}">${s.name} ($${s.price})</option>`).join('')}</select>
      <input type="date" id="bk_date" class="border rounded p-2 w-full mb-2"/>
      <button onclick="submitBooking('${slug}')" class="w-full bg-green-600 text-white py-2 rounded">Book</button>
    </div>
  </div>`;
}

function submitBooking(slug){
  const name=document.getElementById('bk_name').value.trim();
  const email=document.getElementById('bk_email').value.trim();
  const phone=document.getElementById('bk_phone').value.trim();
  const service=document.getElementById('bk_service').value;
  const date=document.getElementById('bk_date').value;if(!name||!email||!phone||!service||!date)return alert('Fill all fields');
  const arr=getBookings(slug);arr.push({name,email,phone,service,date});setBookings(slug,arr);
  alert('Booking successful');renderPublicBooking(slug);
}

/* ---------- On Load ---------- */
window.addEventListener('load',()=>{
  const params=new URLSearchParams(location.search);
  const biz=params.get('business');if(biz) renderPublicBooking(biz);
});
</script>
</body>
</html>
