<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>نونو — Booking Platform</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
.modal-backdrop { background: rgba(0,0,0,0.45); }
</style>
</head>
<body class="bg-gray-50 text-gray-800">

<div id="app" class="min-h-screen flex items-center justify-center p-6"
     style="background-image: linear-gradient(180deg, rgba(255,255,255,0.6), rgba(255,255,255,0.6)), url('https://images.unsplash.com/photo-1504384308090-c894fdcc538d?auto=format&fit=crop&w=1600&q=80'); background-size:cover;">
  <div id="homeCard" class="bg-white/90 backdrop-blur-md rounded-2xl shadow-2xl p-8 text-center max-w-xl w-full">
    <div class="flex items-center justify-center gap-4 mb-4">
      <h1 class="text-3xl font-bold text-gray-900">Grow Your Business with Online Bookings</h1>
    </div>
    <p class="text-gray-600 mb-6">Free demo 7 days or subscribe for $11/month — manage services and bookings.</p>

    <div class="flex flex-col gap-4">
      <button onclick="renderTrialSignup()" class="bg-green-500 hover:bg-green-600 text-white font-semibold py-3 rounded-xl shadow-lg transition">Start 7-Day Trial</button>
      <button onclick="renderSubscriptionSignup()" class="bg-blue-500 hover:bg-blue-600 text-white font-semibold py-3 rounded-xl shadow-lg transition">Subscribe $11/month</button>
      <button onclick="renderLogin()" class="bg-purple-500 hover:bg-purple-600 text-white font-semibold py-3 rounded-xl shadow-lg transition">Login</button>
    </div>
  </div>
</div>

<div id="mousa_modal_container"></div>

<script>
/* ---------- Helpers ---------- */
function uid(prefix='id'){ return prefix+'_'+Math.random().toString(36).slice(2,10); }
function slugify(s){ return String(s||'').toLowerCase().replace(/[^a-z0-9]+/g,'-').replace(/(^-|-$)/g,''); }
function qs(sel){ return document.querySelector(sel); }
function qsa(sel){ return Array.from(document.querySelectorAll(sel)); }

/* ---------- LocalStorage Data ---------- */
function getUser(){ return JSON.parse(localStorage.getItem('nuno_user')||'null'); }
function setUser(u){ localStorage.setItem('nuno_user', JSON.stringify(u)); }
function getServices(slug){ return JSON.parse(localStorage.getItem('nuno_services_'+slug)||'[]'); }
function setServices(slug, arr){ localStorage.setItem('nuno_services_'+slug, JSON.stringify(arr)); }
function getBookings(slug){ return JSON.parse(localStorage.getItem('nuno_bookings_'+slug)||'[]'); }
function setBookings(slug, arr){ localStorage.setItem('nuno_bookings_'+slug, JSON.stringify(arr)); }

/* ---------- Trial / Subscription ---------- */
function renderTrialSignup(){
  const c = document.getElementById('app');
  c.innerHTML = `<div class="min-h-screen flex items-center justify-center w-full">
  <div class="bg-white rounded-2xl shadow p-6 w-full max-w-md">
    <h2 class="text-2xl font-bold mb-4">Start 7-Day Trial</h2>
    <input id="trial_name" placeholder="Business Name" class="w-full border rounded p-3 mb-3"/>
    <input id="trial_email" placeholder="Email" class="w-full border rounded p-3 mb-3"/>
    <input id="trial_pass" placeholder="Password" type="password" class="w-full border rounded p-3 mb-3"/>
    <div class="flex gap-3">
      <button onclick="submitTrial()" class="flex-1 bg-green-600 text-white py-3 rounded">Start Trial</button>
      <button onclick="renderHome()" class="flex-1 border rounded py-3">Cancel</button>
    </div>
  </div></div>`;
}

function submitTrial(){
  const name=qs('#trial_name').value.trim(),email=qs('#trial_email').value.trim(),pass=qs('#trial_pass').value.trim();
  if(!name||!email||!pass){alert('Fill all fields');return;}
  const slug=slugify(name);
  const expiry=new Date(); expiry.setDate(expiry.getDate()+7);
  const user={business:name,email,pass,slug,plan:'trial',expiry:expiry.toISOString(),color:'#2563eb',logo:''};
  setUser(user); setServices(slug,[]); setBookings(slug,[]);
  renderDashboard(user);
}

function renderSubscriptionSignup(){
  const c = document.getElementById('app');
  c.innerHTML = `<div class="min-h-screen flex items-center justify-center w-full">
  <div class="bg-white rounded-2xl shadow p-6 w-full max-w-md">
    <h2 class="text-2xl font-bold mb-4">Subscribe $11/month</h2>
    <input id="sub_name" placeholder="Business Name" class="w-full border rounded p-3 mb-3"/>
    <input id="sub_email" placeholder="Email" class="w-full border rounded p-3 mb-3"/>
    <input id="sub_pass" placeholder="Password" type="password" class="w-full border rounded p-3 mb-3"/>
    <div class="flex gap-3">
      <button onclick="submitSubscription()" class="flex-1 bg-blue-600 text-white py-3 rounded">Subscribe</button>
      <button onclick="renderHome()" class="flex-1 border rounded py-3">Cancel</button>
    </div>
  </div></div>`;
}

function submitSubscription(){
  const name=qs('#sub_name').value.trim(),email=qs('#sub_email').value.trim(),pass=qs('#sub_pass').value.trim();
  if(!name||!email||!pass){alert('Fill all fields');return;}
  const slug=slugify(name);
  const expiry=new Date(); expiry.setMonth(expiry.getMonth()+1);
  const user={business:name,email,pass,slug,plan:'monthly',expiry:expiry.toISOString(),color:'#2563eb',logo:''};
  setUser(user); setServices(slug,[]); setBookings(slug,[]);
  renderDashboard(user);
}

/* ---------- Login ---------- */
function renderLogin(){
  const c = document.getElementById('app');
  c.innerHTML = `<div class="min-h-screen flex items-center justify-center w-full">
  <div class="bg-white rounded-2xl shadow p-6 w-full max-w-md">
    <h2 class="text-2xl font-bold mb-4">Login</h2>
    <input id="login_email" placeholder="Email" class="w-full border rounded p-3 mb-3"/>
    <input id="login_pass" placeholder="Password" type="password" class="w-full border rounded p-3 mb-3"/>
    <div class="flex gap-3">
      <button onclick="submitLogin()" class="flex-1 bg-purple-600 text-white py-3 rounded">Login</button>
      <button onclick="renderHome()" class="flex-1 border rounded py-3">Cancel</button>
    </div>
  </div></div>`;
}

function submitLogin(){
  const email=qs('#login_email').value.trim(),pass=qs('#login_pass').value.trim();
  const user=getUser(); if(!user){alert('No account');return;}
  if(user.email===email&&user.pass===pass){
    renderDashboard(user);
  }else alert('Invalid credentials');
}

/* ---------- Check expiry ---------- */
function checkExpiry(user){
  const now=new Date(); const expiry=new Date(user.expiry);
  const diff=Math.ceil((expiry-now)/(1000*60*60*24));
  if(diff>0){
    qs('#daysRemaining')?.innerText=diff+' day(s) remaining';
    if(diff<=2) alert(`⚠️ Your ${user.plan==='trial'?'trial':'subscription'} ends in ${diff} day(s).`);
    return true;
  }else{ alert(`⛔ Your ${user.plan==='trial'?'trial':'subscription'} has expired.`); logout(); return false;}
}

/* ---------- Dashboard ---------- */
function renderDashboard(user){
  if(!checkExpiry(user)) return;
  const slug=user.slug; const primary=user.color||'#2563eb';
  const services=getServices(slug);
  const bookings=getBookings(slug);

  document.getElementById('app').innerHTML=`<div class="w-full min-h-screen flex flex-col">
  <header class="flex items-center justify-between p-4" style="background:${primary}; color:white;">
    <div class="flex items-center gap-3">
      <div class="text-xl font-bold">${user.business}</div>
      <div class="text-sm">${user.email}</div>
      <div id="daysRemaining" class="text-sm font-semibold mt-1"></div>
    </div>
    <div class="flex gap-3">
      <button onclick="logout()" class="bg-white text-${primary} px-3 py-2 rounded">Logout</button>
      <button onclick="renderPublicLink()" class="bg-white text-${primary} px-3 py-2 rounded">Share Link</button>
    </div>
  </header>
  <main class="p-6 flex-1 max-w-6xl mx-auto">
    <section class="mb-6">
      <h2 class="text-xl font-bold mb-3">Manage Services</h2>
      <div class="flex gap-2 mb-2">
        <input id="newServiceName" placeholder="Service Name" class="border rounded p-2 flex-1"/>
        <input id="newServicePrice" placeholder="Price" type="number" class="border rounded p-2 w-24"/>
        <button onclick="addService()" class="bg-green-600 text-white px-3 py-2 rounded">Add</button>
      </div>
      <ul id="serviceList" class="space-y-2">${services.map(s=>`<li class="flex justify-between border p-2 rounded">
        <span>${s.name} - $${s.price}</span>
        <button onclick="removeService('${s.id}')" class="bg-red-500 text-white px-2 rounded">Delete</button>
      </li>`).join('')}</ul>
    </section>
    <section>
      <h2 class="text-xl font-bold mb-3">Bookings</h2>
      <table class="w-full border-collapse border">
        <thead><tr class="bg-gray-200"><th class="border p-2">Name</th><th class="border p-2">Email</th><th class="border p-2">Phone</th><th class="border p-2">Service</th><th class="border p-2">Date</th></tr></thead>
        <tbody id="bookingList">${bookings.map(b=>`<tr><td class="border p-2">${b.name}</td><td class="border p-2">${b.email}</td><td class="border p-2">${b.phone}</td><td class="border p-2">${b.service}</td><td class="border p-2">${b.date}</td></tr>`).join('')}</tbody>
      </table>
    </section>
  </main></div>`;
}

/* ---------- Service Actions ---------- */
function addService(){
  const name=qs('#newServiceName').value.trim();
  const price=qs('#newServicePrice').value.trim();
  if(!name||!price){alert('Fill fields'); return;}
  const user=getUser(); const slug=user.slug;
  const services=getServices(slug);
  services.push({id:uid(), name, price});
  setServices(slug, services);
  renderDashboard(user);
}
function removeService(id){
  const user=getUser(); const slug=user.slug;
  const services=getServices(slug).filter(s=>s.id!==id);
  setServices(slug, services);
  renderDashboard(user);
}

/* ---------- Public Link ---------- */
function renderPublicLink(){
  const user=getUser(); if(!user)return;
  const slug=user.slug;
  const url=window.location.origin+window.location.pathname+'?business='+slug;
  prompt('Share this link with customers:',url);
}

/* ---------- Public Booking Page ---------- */
function renderPublicBookingPage(slug){
  const services=getServices(slug); 
  document.body.innerHTML=`<div class="min-h-screen flex items-center justify-center p-6 bg-gray-100">
    <div class="max-w-3xl w-full bg-white rounded-xl shadow p-6">
      <h1 class="text-2xl font-bold mb-4">Book Appointment</h1>
      <div class="grid md:grid-cols-2 gap-4 mb-4">
      ${services.length===0?'<div>No services available</div>':services.map(s=>`<div class="p-4 border rounded">
        <div class="font-medium">${s.name}</div>
        <div class="text-sm text-gray-500 mb-2">$${s.price}</div>
        <button onclick="openBookingModal('${slug}','${s.id}')" class="bg-blue-600 text-white px-3 py-2 rounded">Book Now</button>
      </div>`).join('')}
      </div>
    </div></div><div id="mousa_modal_container"></div>`;
}

/* ---------- Booking Modal ---------- */
function openBookingModal(slug,serviceId){
  const services=getServices(slug); const s=services.find(x=>x.id===serviceId);
  if(!s) return;
  const modal=`<div class="fixed inset-0 flex items-center justify-center modal-backdrop z-50">
    <div class="bg-white rounded-xl p-6 w-full max-w-md relative">
      <h2 class="text-xl font-bold mb-4">Book: ${s.name}</h2>
      <input id="book_name" placeholder="Your Name" class="w-full border rounded p-2 mb-2"/>
      <input id="book_email" placeholder="Your Email" class="w-full border rounded p-2 mb-2"/>
      <input id="book_phone" placeholder="Phone" class="w-full border rounded p-2 mb-2"/>
      <input id="book_date" type="date" class="w-full border rounded p-2 mb-4"/>
      <div class="flex gap-3">
        <button onclick="submitBooking('${slug}','${serviceId}')" class="bg-green-600 text-white px-4 py-2 rounded">Confirm</button>
        <button onclick="closeModal()" class="bg-red-500 text-white px-4 py-2 rounded">Cancel</button>
      </div>
    </div>
  </div>`;
  document.getElementById('mousa_modal_container').innerHTML=modal;
}
function closeModal(){ document.getElementById('mousa_modal_container').innerHTML=''; }
function submitBooking(slug,serviceId){
  const name=qs('#book_name').value.trim();
  const email=qs('#book_email').value.trim();
  const phone=qs('#book_phone').value.trim();
  const date=qs('#book_date').value;
  if(!name||!email||!phone||!date){alert('Fill all fields'); return;}
  const services=getServices(slug);
  const service=services.find(x=>x.id===serviceId);
  const bookings=getBookings(slug);
  bookings.push({name,email,phone,service:service.name,date});
  setBookings(slug,bookings);
  closeModal(); alert('Booking confirmed!');
}

/* ---------- On load ---------- */
(function init(){
  const params=new URLSearchParams(window.location.search);
  const biz=params.get('business');
  if(biz){ renderPublicBookingPage(biz); return; }
})();
function renderHome(){ location.href=location.pathname; }
function logout(){ localStorage.removeItem('nuno_user'); location.href=location.pathname; }
</script>
</body>
</html>
